<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../assets/logoEscudo.png" type="image/x-icon">

    <title>Security Bank | Painel Geral</title>

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/RedePedro.css">
    <link rel="stylesheet" href="../css/navbarDash.css">
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="alertasDash.js"></script>


    <script src="DashBarra.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>


    <style>




    </style>




</head>

<!-- <body onload=" atualizarFeed()"> -->

<body onload="exibirServidoresUsuario()">


    <body onload="percentCPU(),percentRAM(),percentDISK(), percentRede(),ReceberUltimosAlertas2()">

        <div class="janela">
            <div class="header-left">
                <div class="logo">
                    <img src="../assets/logoBranca.png" alt="">
                </div>

                <div class="opcao">
                    <span>Olá, <b id="nomeAdm">Nome ADM</b></span>
                </div>

                <div id="nivelACesso" class="TipoAcesso">
                    <span>Administrador</span>
                </div>

                <div class="opcoes">
                    <a href="dashboard.html">
                        <img src="../assets/home.png" alt="">
                        <span>Home</span>
                    </a>
                </div>
                <div class="opcoesServidores  localizacao">
                    <a href="servidoresDash.html">
                        <img src="../assets/servidor.png" alt="">
                        <span>Servidores</span>
                    </a>
                    <div id="opcoesServidores-content" class="opcoesServidores-content">


                    </div>
                </div>

                <div class="opcoes">
                    <a href="">
                        <img src="../assets/servidor.png    " alt="">
                        <span>Visões</span>
                    </a>
                    <!-- <div class="opcoesServidores-content">
                        <a href="alertas.html">Visão 1</a>
                        <a href="alertas.html">Visão 2</a>
                    </div> -->
                </div>
                <!-- <div class="opcoes">
                    <a href="">
                        <img src="../assets/imgs/servdores.png" alt="">
                        <span>Visão Gabriel</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="">
                        <img src="../assets/imgs/servdores.png" alt="">
                        <span>Visão Gustavo</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="">
                        <img src="../assets/imgs/servdores.png" alt="">
                        <span>Visão Marcela</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="">
                        <img src="../assets/imgs/servdores.png" alt="">
                        <span>Visão Natália</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="">
                        <img src="../assets/imgs/servdores.png" alt="">
                        <span>Visão Pedro</span>
                    </a>
                </div> -->
                <div class="opcoes">
                    <a href="alertas.html">
                        <img src="../assets/alerta.png" alt="">
                        <span>Alertas</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="perfil.html">
                        <img src="../assets/perfil.png" alt="">
                        <span>Perfil</span>
                    </a>
                </div>
                <div id="gerenciarAcesso" class="opcoes">
                    <a href="GerenciarAcesso.html">
                        <img src="../assets/controle.png" alt="">
                        <span>Controle de acesso</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="suporteDash.html">
                        <img src="../assets/ajuda.png" alt="">
                        <span>Ajuda</span>
                    </a>
                </div>
                <div class="opcoes">
                    <a href="metricasDash.html">
                        <img src="../assets/metricas.png" alt="">
                        <span>Métricas</span>
                    </a>
                </div>
                <!-- <div class="opcoes">
                    <a href="recFacial.html">
                        <img src="../assets/imgs/recFacial.png" alt="">
                        <span>Reconhecimento Facial</span>
                    </a>
                </div> -->
                <div class="linha">
                    <span></span>
                </div>
                <div class="opcoes">
                    <a href="../index.html">
                        <img src="../assets/logout.png" alt="">
                        <span onclick="limparSessonStorage()">Logout</span>
                    </a>
                </div>
            </div>

            <div class="dash">
                <div id="nomeEspec" class="Nome">
                    <h2>Dados de Rede</h2>
                </div>
                <div class="kpi">
                    <div class="blocoKpi">
                        <div class="img">

                        </div>
                        <div id="Servidores" class="info">

                        </div>
                    </div>


                </div>
                <div class="blocosPai">
                    <div class="parte1">
                        <div class="visaoGeral">
                            <h2>Detalhes de Rede</h2>
                            <span id="IPselecionado">IP:</span>
                        </div>


                        <div class="visaoGeral">
                            <h2>Historico de Rede</h2>
                            <div class="graph">
                                <canvas id="myChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="parte2">
                        <div class="visaoGeral">
                            <h2>Potencia de rede de Download</h2>
                            aaaaaaaaaaaaa
                        </div>
                        <div class="visaoGeral">
                            <h2>Potencia de rede de Upload</h2>
                            aaaaaaaaaaaaa
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="rodapeDash">
            <div class="itens">
                <div class="blocos">
                    <h1>Security Bank</h1>
                    <h4>TECH & SOLUTIONS</h4>
                </div>
                <div class="blocos">
                    <span><b>Telefone:</b>(11)40028922</span>
                    <span><b>Email:</b>SC.contato.2023@gmail.com</span>
                </div>
                <div class="blocos">
                    <span><b>Endereço:</b>Rua Haddock Lobo, 595 -<br>
                        Cerqueira César, São Paulo - SP,<br>
                        01414-001</span>
                </div>
            </div>
            <div class="direitos">&copy; 2023 copyrights by SecurityBank. All Rights Reserved</div>
        </div>
        </div>



    </body>

</html>
<footer>

</footer>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

<script>

    var vetor = [];
    var selectedServer;// Declarar idUsuario fora do escopo da função

    function exibirServidoresUsuario() {
        var server = JSON.parse(sessionStorage.servidor);
        console.log("Conteúdo da sessionStorage.servidor: ", server); // Verificar o conteúdo de sessionStorage.servidor
        var selectServidores = document.getElementById("opcoesServidores-content");
        selectServidores.innerHTML = ""; // Limpar as opções existentes para evitar duplicatas
        server.forEach(element => {
            var button = document.createElement('button');
            button.textContent = element.apelido;
            button.addEventListener("click", function (event) {
                event.preventDefault();
                selectedServer = element.idServidor;
                vetor.push(selectedServer);
                console.log("Valor de selectedServer: ", selectedServer); // Mostra o valor atualizado de selectedServer

                console.log("Valor de idUsuario: ", idUsuario); // Mostra o valor de idUsuario atualizado
                inserir(selectedServer); // Chamar a função inserir com o ID do servidor
                window.location.href = "servidoresDash.html"; // Redirecionar para a página desejada
            });
            selectServidores.appendChild(button);
        });
    }

    function inserir(id) {
        vetor.push(id);
        console.log(vetor);
        sessionStorage.servidorSelecionado = selectedServer
    }

    function MostrarResto() { }


    // Chamar a função exibirServidoresUsuario
    exibirServidoresUsuario();





    var vetor = [];
    var selectedServer;// Declarar idUsuario fora do escopo da função

    function exibirServidoresUsuarioRede() {
        var server = JSON.parse(sessionStorage.servidor);
        console.log("Conteúdo da sessionStorage.servidor: ", server); // Verificar o conteúdo de sessionStorage.servidor
        var selectServidores = document.getElementById("Servidores");
        selectServidores.innerHTML = ""; // Limpar as opções existentes para evitar duplicatas
        server.forEach(element => {
            var button = document.createElement('button');
            button.textContent = element.apelido;
            button.addEventListener("click", function (event) {
                event.preventDefault();
                selectedServer = element.idServidor;
                vetor.push(selectedServer);
                console.log("Valor de selectedServer: ", selectedServer); // Mostra o valor atualizado de selectedServer

                console.log("Valor de idUsuario: ", idUsuario); // Mostra o valor de idUsuario atualizado
                inserirRede(selectedServer); // Chamar a função inserir com o ID do servidor
                window.location.href = "PaginaRedePedro.html"; // Redirecionar para a página desejada
            });
            selectServidores.appendChild(button);
        });
    }

    function inserirRede(id) {
        vetor.push(id);
        console.log(vetor);
        sessionStorage.servidorSelecionado = selectedServer
    }
    console.log(selectedServer)
    // Chamar a função exibirServidoresUsuario
    exibirServidoresUsuarioRede();






    //document.addEventListener("DOMContentLoaded", function () {
    //    percentIpRede(sessionStorage.servidorSelecionado);
    // });
    // window.onload = percentIpRede(sessionStorage.servidorSelecionado);







    window.onload = obterDadosGrafico3(sessionStorage.servidorSelecionado)

    function obterDadosGrafico3(idUsuario) {
        if (idUsuario) {
            idUsuario = sessionStorage.servidorSelecionado
            console.log(idUsuario);
        } else {
            console.error("ID do usuário não encontrada no sessionStorage.");
        }

        fetch(`/medidas/ultimasRedeConnect/${idUsuario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico3(resposta, idUsuario);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGrafico3(resposta, idUsuario) {
        console.log('iniciando plotagem do gráfico...');

        const labels = []
        let dados = {
            labels: ['Ligado', 'Desligado'],
            datasets: [

                {
                    label: 'Ligado',
                    data: [],
                    fill: false,
                    borderColor: ['#36D000', '#FF847F'], // Adicione a cor desejada
                    tension: 0.1,
                    backgroundColor: ['#36D000', '#FF847F']
                },
                {
                    label: 'Desligado',
                    data: [],
                    fill: false,
                    borderColor: ['#FF847F'], // Adicione a cor desejada
                    tension: 0.1,
                    backgroundColor: ['#FF847F']
                }

            ]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico3" e passados para "plotarGrafico3":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];

            dados.datasets[0].data.push(registro.Ligado);
            dados.datasets[0].data.push(registro.Desligado);

        }



        const config = {
            type: 'bar',
            data: dados
        };

        let myChart3 = new Chart(document.getElementById('myChart'), config);

        atualizarGrafico3(idUsuario, dados, myChart3);
    }

    function atualizarGrafico3(idUsuario, dados, myChart3) {
    fetch(`/medidas/tempo-realRedeConnect/${idUsuario}`, {
        cache: 'no-store'
    }).then(function (response) {
        if (response.ok) {
            response.json().then(function (novoRegistro) {
                console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                console.log('Dados atuais do gráfico:');
                console.log(dados);

                // Obtendo o último horário do gráfico
                const ultimoHorario = dados.labels[dados.labels.length - 1];

                if (novoRegistro[0].horario === ultimoHorario) {
                    console.log('Não há novos dados para atualização do gráfico.');
                } else {
                    // Adicionando novos dados ao gráfico
                    
                    dados.datasets[0].data.push(novoRegistro[0].Ligado);
                    dados.datasets[0].data.push(novoRegistro[0].Desligado);

                    // Removendo os primeiros elementos para manter um número fixo de pontos no gráfico
                    if (dados.labels.length > MAX_DATA_POINTS) {
                        dados.labels.shift();
                        dados.datasets[0].data.shift();

                    }

                    // Atualizando o gráfico
                    myChart3.update();
                }

                // Agendando a próxima atualização
                proximaAtualizacao = setTimeout(() => {
                    obterDadosGrafico3(idUsuario);
                }, 20000);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
            // Agendando a próxima atualização em caso de erro
            proximaAtualizacao = setTimeout(() => {
                obterDadosGrafico3(idUsuario);
            }, 20000);
        }
    }).catch(function (error) {
        console.error(`Erro na obtenção dos dados para o gráfico: ${error.message}`);
    });
}





















    function limparSessonStorage() {
        sessionStorage.clear()
    }



</script>