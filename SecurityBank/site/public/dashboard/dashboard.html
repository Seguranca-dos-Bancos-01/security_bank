<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../assets/logoEscudo.png" type="image/x-icon">

    <title>Security Bank | Painel Geral</title>

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboards.css">
    <link rel="stylesheet" href="../css/navbarDash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/sessao.js"></script>
    <script src="../js/alerta.js"></script>
    <script src="alertasDash.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>



<body
    onload=" exibirBolaStatus(),percentCPU(),percentRAM(),percentDISK(), QtdServidor(), alerta24(), sInstaveis(), UltimosAlertas(), ServerEmergencia(), ReceberUltimosAlertas1()">

    <div class="janela">
        <div class="header-left">
            <div class="logo">
                <img src="../assets/logoBranca.png" alt="">
            </div>

            <div class="opcao">
                <span>Olá, <b id="nomeAdm">Nome ADM</b></span>
            </div>

            <div id="nivelACesso" class="TipoAcesso">
                <span>Administrador</span>
            </div>

            <div class="opcoes  localizacao">
                <a href="dashboard.html">
                    <img src="../assets/home.png" alt="">
                    <span>Home</span>
                </a>
            </div>
            <div class="opcoesServidores">
                <a href="servidoresDash.html">
                    <img src="../assets/servidor.png" alt="">
                    <span>Servidores</span>
                </a>
                <div id="opcoesServidores-content" class="opcoesServidores-content">


                </div>
            </div>

            <div class="opcoes">
                <a href="">
                    <img src="../assets/servidor.png    " alt="">
                    <span>Visões</span>
                </a>
                <!-- <div class="opcoesServidores-content">
                    <a href="alertas.html">Visão 1</a>
                    <a href="alertas.html">Visão 2</a>
                </div> -->
            </div>
            <!-- <div class="opcoes">
                <a href="">
                    <img src="../assets/imgs/servdores.png" alt="">
                    <span>Visão Gabriel</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="">
                    <img src="../assets/imgs/servdores.png" alt="">
                    <span>Visão Gustavo</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="">
                    <img src="../assets/imgs/servdores.png" alt="">
                    <span>Visão Marcela</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="">
                    <img src="../assets/imgs/servdores.png" alt="">
                    <span>Visão Natália</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="">
                    <img src="../assets/imgs/servdores.png" alt="">
                    <span>Visão Pedro</span>
                </a>
            </div> -->
            <div class="opcoes">
                <a href="alertas.html">
                    <img src="../assets/alerta.png" alt="">
                    <span>Alertas</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="perfil.html">
                    <img src="../assets/perfil.png" alt="">
                    <span>Perfil</span>
                </a>
            </div>
            <div id="gerenciarAcesso" class="opcoes">
                <a href="GerenciarAcesso.html">
                    <img src="../assets/controle.png" alt="">
                    <span>Controle de acesso</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="suporteDash.html">
                    <img src="../assets/ajuda.png" alt="">
                    <span>Ajuda</span>
                </a>
            </div>
            <div class="opcoes">
                <a href="metricasDash.html">
                    <img src="../assets/metricas.png" alt="">
                    <span>Métricas</span>
                </a>
            </div>
            <!-- <div class="opcoes">
                <a href="recFacial.html">
                    <img src="../assets/imgs/recFacial.png" alt="">
                    <span>Reconhecimento Facial</span>
                </a>
            </div> -->
            <div class="linha">
                <span></span>
            </div>
            <div class="opcoes">
                <a href="../index.html">
                    <img src="../assets/logout.png" alt="">
                    <span onclick="limparSessonStorage()">Logout</span>
                </a>
            </div>
        </div>

        <div class="dash">
            <div id="alerta">
            </div>


            <div class="Nome">
                <h2>Painel Geral</h2>
            </div>

            <div class="dadosGraficos">
                <div class="blocoalertasLateralDash">
                    <div id="colocar" class="UltimoAlerta">
                        <span class="tituloUltimoAlerta">Último Alerta</span>
                        <div id="AlertaUltimoMostrar">
                            <!-- <h4 id="situacaoTittle">alerrat</h4>
                            <span id="horariosAlertas"></span> -->
                        </div>
                    </div>
                    <div class="ServidorEmergencia">
                        <span class="tituloServidorEmergencia">Servidor em Emergência</span>
                        <div class="AlertaUltimoMostrar">
                            <span id="nomeServidorEmergencia"></span>
                            <span id="ServidoresEmEmergencia">
                            </span>
                        </div>
                    </div>
                </div>
                <div class="VisaoGeralServidores">
                    <span class="tituloVisaoGeral">Visão Geral Servidores</span>
                    <div id="graficos2">
                        <div class="graph2">
                            <canvas id="myChartCanvas2"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="barraInformativa">
                <div class="infoBarra">
                    <span class="SituacaoBarra" id="numeroServidores"></span>
                    <span>Servidores Monitorados</span>
                </div>
                <div class="infoBarra">
                    <span class="SituacaoBarra" id="alertaHoras"></span>
                    <span>Alertas em 24 horas</span>
                </div>
                <div class="infoBarra">
                    <span class="SituacaoBarra" id="InstaveisServidores"></span>
                    <span>Servidores Instáveis</span>
                </div>
            </div>
            <div class="Historico">
                <span class="tituloHistorico">Servidores</span>
                <div id="Mostrar-Servidores">



                </div>
            </div>


        </div>
    </div>
    </div>
    <div class="rodapeDash">
        <div class="itens">
            <div class="blocos">
                <h1>Security Bank</h1>
                <h4>TECH & SOLUTIONS</h4>
            </div>
            <div class="blocos">
                <span><b>Telefone:</b>(11)40028922</span>
                <br>
                <span><b>Email:</b>SC.contato.2023@gmail.com</span>
            </div>
            <div class="blocos">
                <span><b>Endereço:</b>Rua Haddock Lobo, 595 -<br>
                    Cerqueira César, São Paulo - SP,<br>
                    01414-001</span>
            </div>
        </div>
        <div class="direitos">&copy; 2023 copyrights by SecurityBank. All Rights Reserved</div>
    </div>


</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
<script>

    var escalonamentoFunc = sessionStorage.FKESCALONAMENTO

    if (escalonamentoFunc != 1) {
        nivelACesso.innerHTML = `<span>Funcionário</span>`
        var divAcesso = document.getElementById("gerenciarAcesso")
        divAcesso.style.display = 'none';
    }

    // var idUsuarioServer = sessionStorage.banco1
    // //    var idUsuarioServer = sessionStorage.ID_USUARIO;

    //     function ReceberUltimosAlertas1(idUsuarioServer) {
    //         if (sessionStorage.ID_USUARIO) {
    //             let idUsuario = sessionStorage.ID_USUARIO;
    //             console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
    //         }
    //         else { console.error("ID do usuário não encontrada no sessionStorage."); }


    //         fetch(`/medidas/buscarUltimosAlertas1/${idUsuario}`, { cache: 'no-store' })
    //             .then(function (response) {
    //                 if (response.ok) {
    //                     response.json()
    //                         .then(function (response) {
    //                             console.log(`Dados recebidos: GRaIFCO AAAAAAAAAAAAAAA ${JSON.stringify(response)}`);
    //                             response.reverse();
    //                             MostrarUltimosAlertas1(response);

    //                         });
    //                 } else { console.error('Nenhum dado encontrado ou erro na API'); }
    //             })
    //             .catch(function (error) {
    //                 console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //             });
    //     }

    //     function MostrarUltimosAlertas1(response) {
    //         console.log('Exibindo dados retornados:')
    //         var dadosMostrar = document.getElementById('AlertaUltimoMostrar');
    //         dadosMostrar.innerHTML = ''; // Limpa o conteúdo anterior antes de adicionar novos dados

    //         // var vetorServidor;
    //         // var vetornomeComponente;
    //         // var vetordataAlerta;
    //         // var vetorhoraAlerta;


    //         for (var i = 0; i < response.length; i++) {
    //             var registro = response[i];

    //             console.log(`AAAAAAAAAAAAAAAAAAAAAAAAAAAA: ${JSON.stringify(registro)}`)
    //             var nomeServidor = registro.nomeServidor;
    //             var nomeComponente = registro.nomeComponente;
    //             var dataAlerta = registro.dataAlerta;
    //             var horaAlerta = registro.horaAlerta;
    //             var statusAlerta = registro.situacaoAlerta;

    //             var elemento = document.createElement('AlertaUltimoMostrar');

    //             var conteudo = `
    //                         <span id="TituloAlerta">${nomeServidor}está em ${statusAlerta}</span><br>
    //                         <span id="dataAlerta"> ${dataAlerta} as  ${horaAlerta}</span>
    //             `;

    //             elemento.innerHTML = conteudo;
    //             dadosMostrar.appendChild(elemento);

    //         }
    //     }

    //     ReceberUltimosAlertas1()

    var vetor = [];
    var selectedServer;// Declarar idUsuario fora do escopo da função
    var i = 0
    function exibirServidoresUsuario() {
        var server = JSON.parse(sessionStorage.servidor);
        console.log("Conteúdo da sessionStorage.servidor: ", server); // Verificar o conteúdo de sessionStorage.servidor
        var selectServidores = document.getElementById("Mostrar-Servidores");
        selectServidores.innerHTML = ""; // Limpar as opções existentes para evitar duplicatas
        server.forEach(element => {
            var button = document.createElement('div');
            button.innerHTML =
                `<span>${element.apelido}</span>
            <div id = "boola"class= "bola"></div>
            `;
 
          //  while ( i <= element.idServidor) {
                // Encontrou o ID do servidor no sessionStorage
              //  var fkStatusKey = sessionStorage.getItem(`BolafkStatus${element.fkStatus}_fkStatus`);



                if (element.fkStatus == 3) { // Por exemplo, alterando a cor se fkStatus for igual a 1
                    var bolaDiv = button.querySelector('.bola'); // Seleciona a div com a classe 'bola'
                    bolaDiv.style.backgroundColor = '#FF0000';
                    i++ // Altera a cor de fundo para vermelho (ou qualquer cor desejada)
                } else if (element.fkStatus == 2) {
                    var bolaDiv = button.querySelector('.bola'); // Seleciona a div com a classe 'bola'
                    bolaDiv.style.backgroundColor = '#F79042';
                    i++ // Altera a cor de fundo para vermelho (ou qualquer cor desejada)

                } else if (element.fkStatus == 4) {
                    var bolaDiv = button.querySelector('.bola'); // Seleciona a div com a classe 'bola'
                    bolaDiv.style.backgroundColor = '#6953D3';
                    i++ // Altera a cor de fundo para vermelho (ou qualquer cor desejada)

                }else if (element.fkStatus == 1) {
                    var bolaDiv = button.querySelector('.bola'); // Seleciona a div com a classe 'bola'
                    bolaDiv.style.backgroundColor = '#36D000';
                    i++ // Altera a cor de fundo para vermelho (ou qualquer cor desejada)

                }else{i++}

            




            button.addEventListener("click", function (event) {
                event.preventDefault();
                selectedServer = element.idServidor;
                vetor.push(selectedServer);
                console.log("Valor de selectedServer: ", selectedServer); // Mostra o valor atualizado de selectedServer

                console.log("Valor de idUsuario: ", idUsuario); // Mostra o valor de idUsuario atualizado
                inserir(selectedServer); // Chamar a função inserir com o ID do servidor
                window.location.href = "servidoresDash.html"; // Redirecionar para a página desejada
            });
            button.classList.add('botoesServidoresDash');
            selectServidores.appendChild(button);
        });
    }

    function inserir(id) {
        vetor.push(id);
        console.log(vetor);
        sessionStorage.servidorSelecionado = selectedServer
    }

    // Chamar a função exibirServidoresUsuario
    exibirServidoresUsuario();


    nomeAdm.innerHTML = sessionStorage.NOME_USUARIO;

    let proximaAtualizacao;




    function exibirServidoresUsuario2() {
        var server = JSON.parse(sessionStorage.servidor);
        console.log("Conteúdo da sessionStorage.servidor: ", server); // Verificar o conteúdo de sessionStorage.servidor
        var selectServidores = document.getElementById("opcoesServidores-content");
        selectServidores.innerHTML = ""; // Limpar as opções existentes para evitar duplicatas
        server.forEach(element => {
            var button = document.createElement('button');
            button.textContent = element.apelido;
            button.addEventListener("click", function (event) {
                event.preventDefault();
                selectedServer = element.idServidor;
                vetor.push(selectedServer);
                console.log("Valor de selectedServer: ", selectedServer); // Mostra o valor atualizado de selectedServer


                console.log("Valor de idUsuario: ", idUsuario); // Mostra o valor de idUsuario atualizado
                inserir2(selectedServer); // Chamar a função inserir com o ID do servidor
                window.location.href = "servidoresDash.html"; // Redirecionar para a página desejada
            });
            selectServidores.appendChild(button);
            button.classList.add('botaodropdown');
        });
    }


    function inserir2(id) {
        vetor.push(id);
        console.log(vetor);
        sessionStorage.servidorSelecionado = selectedServer
    }


    exibirServidoresUsuario2();

    window.onload = BolaStatus(sessionStorage.FKBANCO)


    function BolaStatus(idUsuario) {
        if (sessionStorage.FKBANCO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ultimasBolaStatus/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibirBolaStatus(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function exibirBolaStatus(response) {
        console.log('Exibindo dados retornados:');
        response.forEach((registro, i) => {
            sessionStorage.setItem(`BolaID${i}_idS`, registro.idS);
            sessionStorage.setItem(`BolafkStatus${i}_fkStatus`, registro.fkStatus);
        });
    }












    function percentCPU(idUsuarioCPU) {
        if (sessionStorage.FKBANCO) {

            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ultimasPercentCPU/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibirDadosCPU(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    function exibirDadosCPU(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.asd;
            var limitescpU = {
                estavel: 18,
                atencao: 23,
                emergencia: 50
            };
            if (dado > limitescpU.estavel && dado <= limitescpU.atencao) {
                Swal.fire({
                    icon: 'warning',
                    title: 'CPU EM ATENÇÃO',
                    text: `CPU com ${dado}% de uso!`,
                });
                cadastrarAlertaCPUAtencao()

            } else if (dado > limitescpU.atencao && dado <= limitescpU.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'CPU EM EMERGÊNCIA',
                    text: `CPU com ${dado}% de uso!`,
                });
                cadastrarAlertaCPUEmergencia()



            } else if (dado > limitescpU.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'CPU EM URGÊNCIA',
                    text: `CPU com ${dado}% de uso!`,
                });
                cadastrarAlertaCPUUrgencia()

            }
        }

        console.log(dado)
        console.log(response[0])

        var cpuServidores = document.getElementById('cpuServidores');
        cpuServidores.innerHTML = `${dado}%`;

        var proximaAtualizacao = setTimeout(() => percentCPU(), 5000)
    }



    function percentRAM(idUsuarioRAM) {
        if (sessionStorage.FKBANCO) {
            let idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }



        fetch(`/medidas/ultimasPercentRAM/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibirDadosRAM(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    function exibirDadosRAM(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.asd;
            var limitesram = {
                estavel: 45,
                atencao: 55,
                emergencia: 65
            };
            if (dado > limitesram.estavel && dado <= limitesram.atencao) {
                Swal.fire({
                    icon: 'warning',
                    title: 'MEMÓRIA RAM EM ATENÇÃO',
                    text: `Memória RAM com ${dado}% de uso!`,
                });
                cadastrarAlertaRAMAtencao()

            } else if (dado > limitesram.atencao && dado <= limitesram.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'MEMÓRIA RAM EM EMERGÊNCIA',
                    text: `Memória RAM com ${dado}% de uso!`,
                });
                cadastrarAlertaRAMEmergencia()



            } else if (dado > limitesRAM.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'MEMÓRIA RAM EM URGÊNCIA',
                    text: `Memória RAM com ${dado}% de uso!`,
                });
                cadastrarAlertaRAMUrgencia()

            }
        }

        console.log(dado)
        console.log(response[0])

        var ramServidores = document.getElementById('ramServidores');
        ramServidores.innerHTML = `${dado}%`;

        var proximaAtualizacao = setTimeout(() => percentRAM(), 5000)
    }

    // function exibirDadosRAM(response) {
    //     console.log('Exibindo dados retornados:')
    //     for (i = 0; i < response.length; i++) {
    //         var registro = response[i];
    //         var dadoRAM = registro.ads;

    //     }

    //     console.log(response[0])

    //     var RAMServidores = document.getElementById('ramServidores');
    //     RAMServidores.innerHTML = `${dadoRAM}%`;


    // }



    function percentDISK(idUsuarioDISK) {
        if (sessionStorage.FKBANCO) {
            let idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ultimasPercentDISK/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibirDadosDISK(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    function exibirDadosDISCO(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.asd;
            var limitesdisco = {
                estavel: 50,
                atencao: 70,
                emergencia: 80
            };
            if (dado > limitesdisco.estavel && dado <= limitesdisco.atencao) {
                Swal.fire({
                    icon: 'warning',
                    title: 'DISCO EM ATENÇÃO',
                    text: `Disco com ${dado}% de uso!`,
                });
                cadastrarAlertaDISCOAtencao()

            } else if (dado > limitesdisco.atencao && dado <= limitesdisco.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'DISCO EM EMERGÊNCIA',
                    text: `Disco com ${dado}% de uso!`,
                });
                cadastrarAlertaDISCOAtencao()



            } else if (dado > limitesdisco.emergencia) {
                Swal.fire({
                    icon: 'warning',
                    title: 'DISCO EM URGÊNCIA',
                    text: `Disco com ${dado}% de uso!`,
                });
                cadastrarAlertaDISCOAtencao()

            }
        }

        console.log(dado)
        console.log(response[0])

        var discoServidores = document.getElementById('discoServidores');
        discoServidores.innerHTML = `${dado}%`;

        var proximaAtualizacao = setTimeout(() => percentDISCO(), 5000)
    }



    // function exibirDadosDISK(response) {
    //     console.log('Exibindo dados retornados:')
    //     for (i = 0; i < response.length; i++) {
    //         var registro = response[i];
    //         var dadoRAM = registro.sda;

    //     }

    //     console.log(response[0])

    //     var DISKServidores = document.getElementById('discoServidores');
    //     DISKServidores.innerHTML = `${dadoRAM}%`;


    // }




    function QtdServidor(idUsuario) {
        if (sessionStorage.FKBANCO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ultimasQTD/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibirDadosQTD(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function exibirDadosQTD(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.NumeroDeServidores;

        }
        console.log(dado)
        console.log(response[0])

        var cpuServidores = document.getElementById('numeroServidores');
        cpuServidores.innerHTML = `${dado}`;


    }

    document.addEventListener("DOMContentLoaded", function () {
        QtdServidor();
    });
    window.onload = QtdServidor();



    function alerta24(idUsuario) {
        if (sessionStorage.FKBANCO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ultimas24h/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); exibir24h(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function exibir24h(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.Al;


        }
        console.log(dado)
        console.log(response[0])

        var cpuServidores = document.getElementById('alertaHoras');
        if (dado > 5) {
            cpuServidores.classList.add('textoVermelho');
        } else {
            cpuServidores.classList.add('textoVerde');
        }
        cpuServidores.innerHTML = `${dado}`;


    }


    document.addEventListener("DOMContentLoaded", function () {
        alerta24();
    });
    window.onload = alerta24();






    function sInstaveis(idUsuario) {
        if (sessionStorage.FKBANCO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/sInstaveis/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); MostrarsInstaveis(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function MostrarsInstaveis(response) {
        console.log('Exibindo dados retornados:')
        for (i = 0; i < response.length; i++) {
            var registro = response[i];
            var dado = registro.QuantidadeDeMaquinasInstaveis;


        }
        console.log(dado)
        console.log(response[0])

        var cpuServidores = document.getElementById('InstaveisServidores');
        if (dado > 0) {
            cpuServidores.classList.add('textoVermelho');
        } else {
            cpuServidores.classList.add('textoVerde');
        }
        cpuServidores.innerHTML = `${dado}`;
    }

    document.addEventListener("DOMContentLoaded", function () {
        sInstaveis();
    });
    window.onload = sInstaveis();




    document.addEventListener("DOMContentLoaded", function () {
        UltimosAlertasSelectedServer();
    });
    window.onload = UltimosAlertasSelectedServer();


    function UltimosAlertasSelectedServer(idUsuario) {
        let currentPercentage;

        if (sessionStorage.ID_USUARIO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario);
            document.addEventListener("DOMContentLoaded", function () { });
        } else {
            console.error("ID do usuário não encontrada no sessionStorage.");
        }

        fetch(`/medidas/ultimasUltAlertasSelected2/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (responseData) {
                            console.log(`Dados recebidos: ${JSON.stringify(responseData)}`);
                            responseData.reverse();
                            exibirUltimosAlertasSelected(responseData);
                        });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }



    function exibirUltimosAlertasSelected(response) {

        var ultimosAlertas = document.getElementById('colocar');
        ultimosAlertas.innerHTML = '';
        console.log('Exibindo dados retornados:');
        for (let i = 0; i < response.length; i++) {
            let registro = response[i];
            let dado = registro.situ;
            let dado2 = registro.nomeComponente;
            let dado3 = registro.dataAlerta;
            let dado4 = registro.horaAlerta;

            // const fill = document.getElementById('situacaoTittle');
            // const percentage = document.getElementById('situacaoTittle');
            // percentage.innerText += `${dado} no ${dado2}.`;


            //  const fill2 = document.getElementById('horariosAlertas');
            //  const percentage2 = document.getElementById('horariosAlertas');
            //  percentage2.innerText += `${dado3} as ${dado4}.`;
            // var tituloAlerta = document.getElementById("situacaoTittle")
            // var datahoraAlerta = document.getElementById("horariosAlertas")
            // tituloAlerta.textContent  = `${dado} em ${dado2}`;
            // datahoraAlerta.textContent  = `${dado3} às ${dado4}`;
            // Criação do elemento div
            var elemento = document.createElement('div');
            elemento.classList.add('UltimoAlerta');

            var conteudo = `
            <span class="tituloUltimoAlerta">Último Alerta</span>
            <div class="AlertaUltimoMostrar">
                <span id="TituloAlerta">${dado} no ${dado2}.</span> <br>
                <span id="dataAlerta">${dado3} às ${dado4}.</span>
            </div>
        `;

            elemento.innerHTML = conteudo;

            // Adicionando o novo alerta à seção "Ultimos Alertas"
            var ultimosAlertas = document.getElementById('colocar');
            ultimosAlertas.appendChild(elemento);

            console.log(dado)


            console.log(dado);
            console.log(response[0]);
        }
        var proximaAtualizacao = setTimeout(() => UltimosAlertasSelectedServer(), 35000);
    }


    function ServerEmergencia(idUsuario) {
        if (sessionStorage.FKBANCO) {
            idUsuario = sessionStorage.FKBANCO;
            console.log(idUsuario); document.addEventListener("DOMContentLoaded", function () { });
        }
        else { console.error("ID do usuário não encontrada no sessionStorage."); }


        fetch(`/medidas/ServerEmergencia/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(function (response) {
                            console.log(`Dados recebidos: GRaIFCO ${JSON.stringify(response)}`);
                            response.reverse(); mostrarServerEmergencia(response);
                        });
                } else { console.error('Nenhum dado encontrado ou erro na API'); }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function mostrarServerEmergencia(response) {
        cpuServidores = ''
        cpuServidores2 = ''
        console.log('Exibindo dados retornados:');

        var cpuServidores = document.getElementById('nomeServidorEmergencia');
        var cpuServidores2 = document.getElementById('ServidoresEmEmergencia');

        // Inicializar acumulador de conteúdo


        for (let i = 0; i < response.length; i++) {
            var registro = response[i];
            var quantidadeServidores = registro.qtdE;
            var nomeServidor = registro.nomesServidores;


            if (quantidadeServidores === 0) {
                cpuServidores.innerHTML = `${quantidadeServidores} servidores`;
            } else {
                cpuServidores.innerHTML = `Total: ${quantidadeServidores} servidores`;
                cpuServidores2.innerHTML = `O servidor ${nomeServidor} está em Emergência!`;


            }
        }

    }






    document.addEventListener("DOMContentLoaded", function () {
        ServerEmergencia();
    });
    window.onload = ServerEmergencia();




    console.log(idUsuario);

    document.addEventListener("DOMContentLoaded", function () {
        obterDadosGrafico(idUsuario);
    });


    var servidorFK = sessionStorage.servidor_id1
    var planoFK = sessionStorage.fkPlano1
    var bancoFK = sessionStorage.banco1


    // ALERTA CPU

    function cadastrarAlertaCPUAtencao() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaCPUAtencao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })



        return false;
    }


    function cadastrarAlertaCPUEmergencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaCPUEmergencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }


    function cadastrarAlertaCPUUrgencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaCPUUrgencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }


    // ALERTA MEMORIA RAM

    function cadastrarAlertaRAMAtencao() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaRAMAtencao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })



        return false;
    }


    function cadastrarAlertaRAMEmergencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaRAMEmergencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }


    function cadastrarAlertaRAMUrgencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaRAMUrgencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }



    // ALERTA DISCO

    function cadastrarAlertaDISCOAtencao() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaDISCOAtencao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })



        return false;
    }


    function cadastrarAlertaDISCOEmergencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaDISCOEmergencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }


    function cadastrarAlertaDISCOUrgencia() {

        // Enviando o valor da nova input
        fetch("/medidas/cadastrarAlertaDISCOUrgencia", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                servidorFKServer: servidorFK,
                planoFKServer: planoFK,
                bancoFKServer: bancoFK,
            })
        })

        return false;
    }






    idUsuario2 = sessionStorage.FKBANCO;
    console.log(idUsuario2);

    document.addEventListener("DOMContentLoaded", function () {
        obterDadosGrafico2(idUsuario2);
    });

    function obterDadosGrafico2(idUsuario2) {

        if (sessionStorage.FKBANCO) {
            let idUsuario2 = sessionStorage.FKBANCO;
            console.log(idUsuario2);

            document.addEventListener("DOMContentLoaded", function () {
                obterDadosGrafico2(idUsuario2);
            });
        } else {
            console.error("ID do usuário não encontrada no sessionStorage.");
        }

        fetch(`/medidas/ultimas2/${idUsuario2}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: GRaIFCO 2 ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico2(resposta, idUsuario2);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function plotarGrafico2(resposta, idUsuario2) {
        console.log('iniciando plotagem do gráfico...');

        const cores = ['#FF847F', '#A6E22E', '#66D9EF', '#AE81FF', '#F92672'];

        // Mapear os valores únicos de statuss
        const statussUnicos = [...new Set(resposta.map(item => item.statuss))];

        // Atribuir cores para cada valor de statuss
        const coresPorStatuss = {};
        statussUnicos.forEach((status, index) => {
            coresPorStatuss[status] = cores[index % cores.length];
        });

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados2 = {
            labels: labels,
            datasets: [{
                label: 'Número de Tentativas',
                data: [],
                fill: false,
                backgroundColor: [
                    '#FF847F', '#7CFC00'
                ],
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i2 = 0; i2 < resposta.length; i2++) {
            var registro = resposta[i2];
            labels.push(registro.statuss);
            dados2.datasets[0].data.push(registro.num);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados2.datasets)
        console.log('----------------------------------------------')

        const config = {
            type: 'doughnut',
            data: dados2,
        };

        // Adicionando gráfico criado em div na tela
        let myChart2 = new Chart(
            document.getElementById('myChartCanvas2'),
            config
        );


        // Defina a próxima atualização de acordo com a sua lógica, se necessário
        // setTimeout(() => atualizarGrafico2(idUsuario2, dados2, myChart2), 2000);
    }

    function atualizarGrafico2(idUsuario2, dados2, myChart2) {
        fetch(`/medidas/tempo-real2/${idUsuario2}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro2) {

                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro2)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados2);

                    if (novoRegistro2[0].momento_grafico == dados2.labels[dados2.labels.length - 1]) {
                        console.log("---------------------------------------------------------------");
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.");
                        console.log("Horário do novo dado capturado:");
                        console.log(novoRegistro2[0].tentativas);
                        console.log("Horário do último dado capturado:");
                        console.log(dados2.labels[dados2.labels.length - 1]);
                        console.log("---------------------------------------------------------------");
                    } else {
                        if (dados2.labels.length >= 7) {
                            dados2.labels.shift(); // apagar o primeiro
                            dados2.datasets[0].data.shift(); // apagar o primeiro de umidade
                        }
                        dados2.labels.push(novoRegistro2[0].statuss); // incluir um novo momento
                        dados2.datasets[0].data.push(novoRegistro2[0].num); // incluir uma nova medida de umidade

                        myChart2.update();

                        proximaAtualizacao = setTimeout(() => {
                            buscarUltimasMedidas2(idUsuario2);
                        }, 20000);


                    }
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');

                proximaAtualizacao = setTimeout(() => {
                    obterDadosGrafico2(idUsuario2);
                }, 20000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(() => {
            obterDadosGrafico2(idUsuario);
        }, 20000);
    }

    function limparSessonStorage() {
        sessionStorage.clear()
    }



</script>